#/bin/env bash
echo checking shell environment...
sleep 1
ls ~/.zshrc 2>&1 >/dev/null&& grep -E "^source ~/.bashrc" ~/.zshrc  2>&1 1>/dev/null|| echo "\nsource ~/.bashrc" >> ~/.zshrc
echo add ssh agent...
sleep 1 
grep  "ssh-add" ~/.bashrc 2>/dev/null||echo "\nssh-add >/dev/null" >> ~/.bashrc >/dev/null
echo check old ssh config ...
sleep 1
echo "请输入邮箱前缀:"
read mail_prefix
if [ -e ~/.ssh/config ];then
	echo "配置已存在，删除配置吗?[N/y]"
	read delete
	if [ "$delete"x = "y"x ];then
		echo backing up ssh config...
		sleep 1
		mv ~/.ssh/config ~/.ssh/config_old
	else
		echo "无法为你自动生成配置,请先删除自定义配置"
		echo 正在退出..
		sleep 2
		exit 
	fi	
fi
echo fetch ssh config frome remote server ...
sleep 1
curl https://sa.in.zhihu.com/1stday/i_am_$mail_prefix -o ~/.ssh/config -s
#curl http://127.0.0.1:9777/1stday/i_am_$mail_prefix -o ~/.ssh/config  -s

echo configuring shell environment...
sleep 1
source ~/.bashrc
echo "Done all ssh config is ready"
echo "Congratulations!!All configuation has done,you can now carefully login into production environment"
sleep 1
echo 本地配置完成，按回车看跳板机地址
read
cat << EOF

各个机房跳板机登陆
金山云 ssh gwpek
公有云离线 ssh gwpkx
腾讯黑石 ssh gwtc
测试环境 和办公室直通
你需要先登陆跳板机，在直接 ssh 主机名/FQDN 登陆

eg:ssh gwtc，然后 ssh data2019


EOF
sleep 3
echo 你也可以本地直接登陆机器，按回车键查看
read
cat << EOF


本地直接登陆机器的方法(以 gateway01 为例)
测试环境 ssh gateway01.dev
腾讯黑石 ssh gateway01.tc
金山云 ssh gateway01.pek01
公有云离线机房 ssh gateway01.pkx01


EOF
sleep 3
echo "配置全部完成，按回车键退出,如有疑问,请 oncall SA"
read
